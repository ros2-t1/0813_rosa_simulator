# 🤖 ROSA 자동 로봇 할당 시스템 가이드

## 🎯 핵심 기능

ROSA는 이제 **자동 로봇 선택 및 업무 대기열 시스템**을 지원합니다!

### ✨ 새로운 명령 방식

#### 1. **로봇 지정 명령** (기존 방식)
```bash
3번 물 왼쪽방        # DP_03에 물 배달 업무 할당
9번 오른쪽방 가      # DP_09를 오른쪽방으로 이동
```

#### 2. **자동 할당 명령** (NEW! 🔥)
```bash
물 왼쪽방            # 최적의 로봇이 자동으로 선택되어 물 배달
오른쪽방 가          # 최적의 로봇이 자동으로 오른쪽방으로 이동
```

## 🧠 로봇 선택 우선순위

자동 할당 시 다음 우선순위로 최적 로봇을 선택합니다:

### 1. **로봇 상태** (가장 중요)
- ✅ **충전중 (CHARGING)**: 우선순위 1위
- ✅ **복귀중 (RETURNING)**: 우선순위 2위
- ❌ **기타 상태**: 업무 할당 불가

### 2. **배터리 잔량**
- 배터리가 많이 남은 로봇 우선

### 3. **거리**
- 목적지에 가까운 로봇 우선

### 4. **예시**
```
상황: 왼쪽방으로 물 배달 요청

DP_03: 충전중, 배터리 80%, 왼쪽방에서 거리 2m
DP_09: 복귀중, 배터리 90%, 왼쪽방에서 거리 1m

결과: DP_03 선택 (충전중 > 복귀중 우선)
```

## 📋 업무 대기열 시스템

### **대기열 처리 방식**
1. **즉시 할당 불가 시**: 업무가 대기열에 등록
2. **로봇 사용 가능 시**: 대기열에서 자동으로 할당
3. **우선순위 처리**: 재등록된 업무(중단된 업무) 최우선

### **대기열 우선순위**
- 🔴 **HIGH**: 중단된 업무 (최우선)
- 🟡 **NORMAL**: 일반 신규 업무

### **대기열 상태 확인**
```bash
대기열              # 현재 대기열 상태 확인
```

출력 예시:
```
📊 업무 대기열 상태:
   대기 중: 2개, 할당됨: 1개
   📋 대기 업무:
     1. 🔴 ROSA_0001_1234567: 왼쪽방 (자동할당)
     2. 🟡 ROSA_0002_1234568: 오른쪽방 (DP_09)
   🤖 할당된 업무:
     DP_03: ROSA_0003_1234569 (면회실)
```

## 🔄 중단된 업무 재등록

### **자동 재등록 상황**
다음 상황에서 진행 중인 업무가 자동으로 대기열에 재등록됩니다:

1. **강제 복귀**: `3번 퇴근해`
2. **비상정지**: `3번 멈춰`  
3. **배터리 부족**: 자동 복귀
4. **타임아웃**: 1분 이상 응답 없음
5. **네트워크 문제**: 통신 두절

### **재등록 특징**
- 🔴 **최우선순위**: 신규 업무보다 먼저 처리
- 🤖 **자동 할당**: 원래 로봇이 아닌 최적 로봇으로 재할당
- 📊 **시도 횟수**: 재시도 횟수 추적

## 💡 명령어 예시

### **배달 업무**
```bash
# 로봇 지정
3번 물 왼쪽방                   # DP_03이 물을 왼쪽방에 배달
9번 도시락 면회실               # DP_09가 도시락을 면회실에 배달

# 자동 할당 (추천!)
물 왼쪽방                      # 최적 로봇이 물을 왼쪽방에 배달  
도시락 면회실                  # 최적 로봇이 도시락을 면회실에 배달
```

### **이동 업무**
```bash
# 로봇 지정
3번 왼쪽방 가                  # DP_03이 왼쪽방으로 이동
9번 충전소 가                  # DP_09가 충전소로 이동

# 자동 할당 (추천!)
왼쪽방 가                     # 최적 로봇이 왼쪽방으로 이동
충전소 가                     # 최적 로봇이 충전소로 이동
```

### **상태 확인**
```bash
다들 뭐해                     # 모든 로봇 상태 확인
대기열                       # 업무 대기열 상태 확인
3번 어디야                   # DP_03 위치 확인
```

## 🎯 사용 권장사항

### ✅ **추천**
- 자동 할당 사용: `물 왼쪽방`, `오른쪽방 가`
- 효율적이고 최적화된 로봇 선택
- 대기열 시스템으로 업무 누락 방지

### ⚠️ **특별한 경우만 로봇 지정**
- 특정 로봇이 필요한 경우: `3번 물 왼쪽방`
- 테스트나 디버깅 시
- 로봇별 특수 기능 필요 시

## 🔧 시스템 흐름

```
1. 명령 입력 → 2. 파싱 → 3. 대기열 등록
                                ↓
8. 업무 완료 ← 7. 업무 실행 ← 6. 실제 할당 ← 5. 로봇 선택
                                ↑
                        4. 사용 가능한 로봇 있음?
                           (없으면 대기열에서 대기)
```

이제 ROSA가 진짜 똑똑한 멀티로봇 시스템이 되었습니다! 🎉